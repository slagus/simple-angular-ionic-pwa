function FocusController(){"use strict";var a=!1,b=[],c=!1,d=null;this.isFocusableItem=function(a){for(var c=0;c<b.length;c++)if(b[c]===a)return!0;return!1},this.pushFocusableItem=function(a){return b.push(a),a.getElement().addEventListener("focus",function(){d=a},!1),b.length-1},this.removeFocusableItem=function(a){for(var c=0;c<b.length;c++)if(b[c]===a)return b.splice(c,1),!0;return!1},this.removeAllFocusableItems=function(){b=[]},this.getFocusableItemCount=function(){return b.length},this.getFocusableItem=function(a){return a>=b.length?null:b[a]},this.getCurrentlyFocusedItem=function(){return d},this.isMoving=function(){return c},this.setCurrentFocusItem=function(a){var b=this.getFocusableItem(a);d=b,null!==d&&d.getElement().focus()},this.moveFocus=function(a){if(d){var b=null;0===a.y?b=a.x>0?d.getRightFocusItemIndex():d.getLeftFocusItemIndex():0===a.x&&(b=a.y>0?d.getTopFocusItemIndex():d.getBottomFocusItemIndex()),null!==b&&this.setCurrentFocusItem(b)}},this.isDebugMode=function(){return a},this.toggleDebugMode=function(){a=!a,this.updateFocusGraph()},this.calcDistance=function(a,b){return Math.floor(Math.sqrt(a*a+b*b))},document.addEventListener("keydown",function(a){this.onKeyDown(a)}.bind(this),!1),document.addEventListener("keyup",function(a){this.onKeyUp(a)}.bind(this),!1)}function FocusableItem(a){"use strict";var b,c=a,d=!1;this.getElement=function(){return c},this.setFocusState=function(a){d=a,this.onFocusStateChange(a)},this.resetFocusableItems=function(){b={top:null,bottom:null,left:null,right:null}},this.setTopFocusItemIndex=function(a){b.top=a},this.getTopFocusItemIndex=function(){return b.top},this.setBottomFocusItemIndex=function(a){b.bottom=a},this.getBottomFocusItemIndex=function(){return b.bottom},this.setLeftFocusItemIndex=function(a){b.left=a},this.getLeftFocusItemIndex=function(){return b.left},this.setRightFocusItemIndex=function(a){b.right=a},this.getRightFocusItemIndex=function(){return b.right},this.resetFocusableItems()}function GenericFocusableItem(a,b){"use strict";FocusableItem.call(this,a);var c={clickDown:"clickdown"},d=null,e=b;this.setOnItemClickCallback=function(a){d=a},this.getOnItemClickCallback=function(){return d},this.getClassStates=function(){return c},this.getContainerId=function(){return e}}function resetFocusController(){window.dpadFocusController.removeAllFocusableItems();for(var a=document.querySelectorAll(".dpad-focusable"),b=0;b<a.length;b++)window.dpadFocusController.addFocusableItem(new GenericFocusableItem(a[b]));window.dpadFocusController.updateFocusGraph(),a.length>0&&window.dpadFocusController.setCurrentFocusItem(0)}FocusController.prototype.addFocusableItem=function(a){"use strict";this.isFocusableItem(a)||this.pushFocusableItem(a)},FocusController.prototype.updateFocusGraph=function(){"use strict";this.clearDebugLines();for(var a=this.getFocusableItemCount(),b=0;a>b;b++){var c=this.getFocusableItem(b);this.isFocusable(c.getElement())&&(this.updateNodeEdges(b),this.isDebugMode()&&this.printDebugLinesForNode(b,c))}},FocusController.prototype.clearDebugLines=function(){for(var a=document.querySelectorAll(".dpad-debug-line"),b=0;b<a.length;b++)a[b].remove()},FocusController.prototype.printDebugLinesForNode=function(a,b){"use strict";var c,d,e,f,g=["#1abc9c","#2ecc71","#3498db","#9b59b6","#34495e","#f1c40f","#e67e22","#e74c3c","#ecf0f1","#95a5a6"],h=a%g.length,i=g[h],j=this.getItemMetrics(b.getElement());null!==b.getTopFocusItemIndex()&&(c=this.getItemMetrics(this.getFocusableItem(b.getTopFocusItemIndex()).getElement()),d=c.center.x-j.center.x,e=j.top-c.center.y,f=180*Math.atan2(d,e)/Math.PI+180,this.printDebugLine(this.calcDistance(d,e),j.center.x-5,j.top,i,f)),null!==b.getBottomFocusItemIndex()&&(c=this.getItemMetrics(this.getFocusableItem(b.getBottomFocusItemIndex()).getElement()),d=j.center.x-c.center.x,e=c.center.y-j.bottom,f=180*Math.atan2(d,e)/Math.PI+360,this.printDebugLine(this.calcDistance(d,e),j.center.x+5,j.bottom,i,f)),null!==b.getLeftFocusItemIndex()&&(c=this.getItemMetrics(this.getFocusableItem(b.getLeftFocusItemIndex()).getElement()),d=c.center.x-j.left,e=j.center.y-c.center.y,f=180*Math.atan2(d,e)/Math.PI+180,this.printDebugLine(this.calcDistance(d,e),j.left,j.center.y+5,i,f)),null!==b.getRightFocusItemIndex()&&(c=this.getItemMetrics(this.getFocusableItem(b.getRightFocusItemIndex()).getElement()),d=c.center.x-j.right,e=j.center.y-c.center.y,f=180*Math.atan2(d,e)/Math.PI+180,this.printDebugLine(this.calcDistance(d,e),j.right,j.center.y-5,i,f))},FocusController.prototype.printDebugLine=function(a,b,c,d,e){"use strict";var f=document.createElement("div");f.classList.add("dpad-debug-line"),f.classList.add("marker"),f.classList.add("start"),f.style.position="absolute",f.style.width="5px",f.style.height=a+"px",f.style.left=b+"px",f.style.top=c+"px",f.style.backgroundColor=d,f.style["-webkit-transform"]="rotate("+e+"deg)",f.style["-webkit-transform-origin"]="0% 0%",document.body.appendChild(f)},FocusController.prototype.updateNodeEdges=function(a){"use strict";var b,c,d,e,f=this.getFocusableItem(a),g=this.getItemMetrics(f.getElement()),h=this.getFocusableItemCount();window.debug=this.isDebugMode()&&"debug"===f.getElement().id?!0:!1;for(var i=0;h>i;i++){var j=this.getFocusableItem(i);if(this.isFocusable(j.getElement())&&j!==f){var k=this.getItemMetrics(j.getElement()),l=this.getTopDistance(g,k),m=this.getBottomDistance(g,k),n=this.getLeftDistance(g,k),o=this.getRightDistance(g,k);window.debug&&(console.log("New Element to Test: ",j.getElement()),console.log("distanceTop: ",l),console.log("distanceBottom: ",m),console.log("distanceLeft: ",n),console.log("distanceRight: ",o)),null!==l&&("undefined"==typeof b||b>l)&&(b=l,f.setTopFocusItemIndex(i)),null!==m&&("undefined"==typeof c||c>m)&&(c=m,f.setBottomFocusItemIndex(i)),null!==n&&("undefined"==typeof d||d>n)&&(d=n,f.setLeftFocusItemIndex(i)),null!==o&&("undefined"==typeof e||e>o)&&(e=o,f.setRightFocusItemIndex(i))}}},FocusController.prototype.isFocusable=function(a){"use strict";if("none"===a.style.display||"hidden"===a.style.visibility)return!1;var b=a.getAttribute("tabindex");return b=null===b?-1:b,b>-1},FocusController.prototype.getTopDistance=function(a,b){"use strict";var c={x:null,y:null};if(b.bottom<=a.top&&(c.y=a.center.y-b.center.y),c.left=Math.abs(a.center.x-b.left),c.right=Math.abs(a.center.x-b.right),c.x=Math.min(Math.abs(a.center.x-b.left),Math.abs(a.center.x-b.center.x),Math.abs(a.center.x-b.right)),null===c.left||null===c.right||null===c.y)return null;var d=Math.atan(c.y/c.left)*(180/Math.PI),e=Math.atan(c.y/c.right)*(180/Math.PI);return window.debug&&console.log("Top Angle Left = "+d+" Right = "+e),d>=0&&180>=e?this.calcDistance(c.x,c.y):null},FocusController.prototype.getBottomDistance=function(a,b){"use strict";var c={x:null,y:null};if(a.bottom<=b.top&&(c.y=b.center.y-a.center.y),c.left=Math.abs(a.center.x-b.left),c.right=Math.abs(a.center.x-b.right),c.x=Math.min(Math.abs(a.center.x-b.left),Math.abs(a.center.x-b.center.x),Math.abs(a.center.x-b.right)),null===c.x||null===c.y)return null;var d=Math.atan(c.y/c.left)*(180/Math.PI),e=Math.atan(c.y/c.right)*(180/Math.PI);return window.debug&&console.log("Bottom Angle Left = "+d+" Bottom = "+e),d>=0&&180>=e?this.calcDistance(c.x,c.y):null},FocusController.prototype.getLeftDistance=function(a,b){"use strict";var c={x:null,y:null};if(b.right<=a.left&&(c.x=a.center.x-b.center.x),c.top=Math.abs(a.center.y-b.top),c.bottom=Math.abs(a.center.y-b.bottom),c.y=Math.min(Math.abs(a.center.y-b.top),Math.abs(a.center.y-b.center.y),Math.abs(a.center.y-b.bottom)),null===c.x||null===c.y)return null;var d=Math.atan(c.x/c.top)*(180/Math.PI),e=Math.atan(c.x/c.bottom)*(180/Math.PI);return window.debug&&console.log("Left Angle Top = "+d+" Bottom = "+e),d>=0&&180>=e?this.calcDistance(c.x,c.y):null},FocusController.prototype.getRightDistance=function(a,b){"use strict";var c={x:null,y:null};if(a.right<=b.left&&(c.x=b.center.x-a.center.x),c.top=Math.abs(a.center.y-b.top),c.bottom=Math.abs(a.center.y-b.bottom),c.y=2*Math.min(Math.abs(a.center.y-b.top),Math.abs(a.center.y-b.center.y),Math.abs(a.center.y-b.bottom)),null===c.x||null===c.y)return null;var d=Math.atan(c.x/c.top)*(180/Math.PI),e=Math.atan(c.x/c.bottom)*(180/Math.PI);return window.debug&&console.log("Right Angle Top = "+d+" Bottom = "+e),d>=0&&180>=e?this.calcDistance(c.x,c.y):null},FocusController.prototype.getItemMetrics=function(a){"use strict";var b=a.getBoundingClientRect(),c={width:b.width,height:b.height,left:b.left,right:b.left+b.width,top:b.top,bottom:b.top+b.height,center:{x:b.left+b.width/2,y:b.top+b.height/2}};return c},FocusController.prototype.onKeyDown=function(a){"use strict";switch(a.keyCode){case 9:break;case 37:a.preventDefault(),this.moveFocus({x:-1,y:0});break;case 38:a.preventDefault(),this.moveFocus({x:0,y:1});break;case 39:a.preventDefault(),this.moveFocus({x:1,y:0});break;case 40:a.preventDefault(),this.moveFocus({x:0,y:-1});break;case 13:a.preventDefault(),this.getCurrentlyFocusedItem()&&this.getCurrentlyFocusedItem().onItemClickStateChange(!0)}},FocusController.prototype.onKeyUp=function(a){"use strict";switch(a.keyCode){case 13:a.preventDefault(),this.getCurrentlyFocusedItem()&&this.getCurrentlyFocusedItem().onItemClickStateChange(!1)}},FocusableItem.prototype.onItemClickStateChange=function(){},GenericFocusableItem.prototype=new FocusableItem,GenericFocusableItem.prototype.onItemClickStateChange=function(a){"use strict";var b=this.getElement();if(a)b.classList.add(this.getClassStates().clickDown);else{b.classList.remove(this.getClassStates().clickDown);var c=document.createEvent("MouseEvents");c.initEvent("click",!0,!0),b.dispatchEvent(c)}},window.addEventListener("load",function(){"use strict";window.dpadFocusController=new FocusController,window.dpadFocusController.reset=resetFocusController,window.dpadFocusController.reset()},!0),window.addEventListener("resize",function(){"use strict";window.dpadFocusController&&window.dpadFocusController.updateFocusGraph()},!1);